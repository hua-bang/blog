<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mini bundler 的实现 | 华铧's Blog</title>
    <meta name="description" content="Inspire Creativity, Enrich Life.">
    <link rel="preload stylesheet" href="/blog/assets/style.d155ef9f.css" as="style">
    
    <script type="module" src="/blog/assets/app.659d5b29.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.342ecb87.js">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.3107ac4f.js">
    <link rel="modulepreload" href="/blog/assets/tech_mini-bundler.md.4fdbfea2.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1919c326><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-1919c326 data-v-7e5bc4a5><div class="VPNavBar has-sidebar" data-v-7e5bc4a5 data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle has-sidebar" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/blog/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://avatars.githubusercontent.com/u/47221942?v=4" style="border-radius:50%;" alt data-v-8426fc1a><!--]--><!--[-->华铧&#39;s Blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-a0fd61f4><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/tech/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>🧑🏻‍💻 Tech</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/blog/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>✍🏼 Blog</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/read/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>📖 Read</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/algorithms/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>📚 Algorithms</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/life/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>👋🏻 Life</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/me/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>⭐️ Me</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-f6a63727><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-f6a63727 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a0fd61f4 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hua-bang" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hua-bang" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-1919c326 data-v-79c8c1df><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-79c8c1df><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-79c8c1df><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-79c8c1df>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-1919c326 data-v-b00e2fdd><div class="curtain" data-v-b00e2fdd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b00e2fdd><span class="visually-hidden" id="sidebar-aria-label" data-v-b00e2fdd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>AIGC</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/gpt-agent.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>基于 GPT 实现 Agent  🤖️</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/chat-bot.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>基于 OpenAI 的 API 快速搭建 ChaBot 🤖️</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/gpt-review.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>GPT + GitHub 实现自动 Code Review</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>编译</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/babel-javaScript-compiler.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Babel: A JavaScript Compiler</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/super-tiny-compiler.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>通过 the-super-tiny-compiler 初识编译</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/auto-tracker.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>通过 Babel 编译实现自动点击埋点</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/introduction-front-end-compilation.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>初识前端编译及 Babel</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 has-active" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>Frontend Engineer</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/bundler.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>初识前端 bundler</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/mini-bundler.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>mini bundler 的实现</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/mini-bundler-plugin.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>mini bundler 插件系统</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/mini-bundler-loader.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>mini-bundler 实现：loader</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/webpack-hmr.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>webpack 中的 HMR</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>TypeScript</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/tech/typescript-skill.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>TypeScript的类型编程小技巧</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1919c326 data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-6ae8e080><div class="content" data-v-6ae8e080><div class="outline-marker" data-v-6ae8e080></div><div class="outline-title" role="heading" data-v-6ae8e080>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-6ae8e080><span class="visually-hidden" id="doc-outline-aria-label" data-v-6ae8e080> Table of Contents for current page </span><ul class="root" data-v-6ae8e080 data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _blog_tech_mini-bundler" data-v-6b87e69f><div><h1 id="mini-bundler-的实现" tabindex="-1">mini bundler 的实现 <a class="header-anchor" href="#mini-bundler-的实现" aria-label="Permalink to &quot;mini bundler 的实现&quot;">​</a></h1><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>上篇<a href="https://juejin.cn/post/7312844725181218857" target="_blank" rel="noreferrer">初识前端 bundler</a>，我们简单介绍了 <code>bundler</code> 的概念，特点以及常用的工具，那么本文我们就来进行 bundler 的设计。</p><h2 id="_1-bundler-具备的能力" tabindex="-1">1. bundler 具备的能力 <a class="header-anchor" href="#_1-bundler-具备的能力" aria-label="Permalink to &quot;1. bundler 具备的能力&quot;">​</a></h2><p>在设计之前，我们先来看看一个 bundler 本身需要具备哪些功能/能力。</p><p><img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/1937f302c6bd454dbb3dc9d96b98ac76%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="bundler.png"></p><p><strong><code>模块解析</code></strong></p><ul><li><strong>解析机制</strong>：详细说明如何解析一个模块，包括读取文件、处理不同类型的模块（如JS, CSS, 图片等）。</li><li><strong>依赖提取</strong>：讨论如何从模块代码中提取依赖关系，例如使用正则表达式或AST（抽象语法树）分析。</li><li><strong>路径解析</strong>：解释如何处理模块路径，包括相对路径和绝对路径的转换。</li></ul><p><strong><code>依赖图构建</code></strong></p><ul><li><strong>图的数据结构</strong>：介绍用于表示依赖关系的数据结构（如对象、数组、图等）。</li><li><strong>构建过程</strong>：详细描述构建依赖图的过程，包括如何处理循环依赖、缺失模块等问题。</li><li><strong>优化策略</strong>：如果有，讨论为提高性能而采取的优化策略，如延迟解析、缓存等。</li></ul><p><strong><code>代码转换</code></strong></p><ul><li><strong>转换工具</strong>：介绍用于代码转换的工具或库，例如Babel（用于ES6转换）。</li><li><strong>处理流程</strong>：详细说明代码转换的步骤，包括语法树转换、特性降级等。</li></ul><p><strong><code>打包和输出</code></strong></p><ul><li><strong>打包算法</strong>：描述如何将依赖图转换为浏览器可运行的代码包。</li><li><strong>输出格式</strong>：讨论支持的输出格式（如UMD, CommonJS, ES Module等）。</li><li><strong>代码分割和懒加载</strong>：如果支持，详细说明如何实现代码分割和懒加载功能。</li></ul><p><strong><code>性能优化</code></strong></p><ul><li><strong>打包速度</strong>：探讨如何优化打包过程的速度，例如通过并行处理或利用缓存。</li><li><strong>输出优化</strong>：介绍如何优化输出文件的大小，例如通过压缩、Tree Shaking等技术。</li></ul><p><strong><code>错误处理和调试</code></strong></p><ul><li><strong>错误检测</strong>：说明如何检测和处理在打包过程中出现的错误。</li><li><strong>调试支持</strong>：讨论如何支持开发者调试打包后的代码，如Source Map的生成和使用。</li></ul><p>由于本次我们希望能实现一个简易版本的 bundler, 所以这块我们一开始不会设计的过于复杂，而是一步一步从最基本的开始。</p><h2 id="_2-bundler-的设计" tabindex="-1">2. bundler 的设计 <a class="header-anchor" href="#_2-bundler-的设计" aria-label="Permalink to &quot;2. bundler 的设计&quot;">​</a></h2><p><img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/6f0cd10cabbc496fa943b5b58e519cfc%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="mini bundler.png"></p><p>我们提取出 bundler 比较核心的点，然后我们来进行 mini-bundler 的编写。即实现模块解析、依赖图构建、代码转化、插件系统的功能。</p><p><strong><code>模块解析</code></strong></p><ul><li><strong>文件读取</strong>：实现对文件系统的读取，用于获取模块内容。</li><li><strong>模块类型处理</strong>：处理不同类型的模块，例如JavaScript和JSON。</li><li><strong>依赖检测</strong>：解析模块中的<code>import</code>或<code>require</code>语句，以识别依赖关系。</li></ul><p><strong><code>依赖图构建</code></strong></p><ul><li><strong>数据结构</strong>：定义一个简单的数据结构来表示模块及其依赖关系。</li><li><strong>递归解析</strong>：从入口文件开始，递归地解析每个模块的依赖。</li></ul><p><strong><code>代码转换</code></strong></p><ul><li><strong>字符串处理</strong>：将模块内容转换成可执行的代码字符串，可能包括对特定语法的转换。</li><li><strong>Bundling</strong>：合并所有模块的代码字符串为一个单独的bundle文件。</li></ul><p><strong><code>插件系统</code></strong></p><ul><li><strong>简单的插件接口</strong>：设计一个基本的插件接口，允许插件在特定的生命周期点介入。</li><li><strong>插件的应用</strong>：在bundler的处理流程中，如模块解析或代码转换阶段，应用插件的逻辑。</li></ul><h2 id="_3-mini-bundler-具体实现" tabindex="-1">3. mini-bundler 具体实现 <a class="header-anchor" href="#_3-mini-bundler-具体实现" aria-label="Permalink to &quot;3. mini-bundler 具体实现&quot;">​</a></h2><p>我们来开始对每个模块进行设计。</p><h3 id="模块解析" tabindex="-1">模块解析 <a class="header-anchor" href="#模块解析" aria-label="Permalink to &quot;模块解析&quot;">​</a></h3><p>在设计前，首先我们先明白为什么需要模块解析：<code>代码组织和维护性</code>、<code>依赖管理</code>、<code>性能优化</code>。</p><p>所以，模块这一个概念在 bundler 中是十分重要的。在这里，我们最好去对模块进行数据结构的抽象。这个模块对象用于存储解析模块过程中获得的数据，包括模块的<code>路径</code>、<code>内容</code>、<code>依赖</code>等信息。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Moudule</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">id</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 唯一标识符，例如模块的绝对路径</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">filePath</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 模块文件的路径 </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">content</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 模块的原始内容 </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">dependencies</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">[]; </span><span style="color:#6A737D;">// 依赖数组，存储依赖模块的路径</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">mapping</span><span style="color:#F97583;">?:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Record</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">&gt;; </span><span style="color:#6A737D;">// 依赖的相对路径和绝对路径的映射关系</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Moudule</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">id</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// 唯一标识符，例如模块的绝对路径</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">filePath</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// 模块文件的路径 </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">content</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// 模块的原始内容 </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">dependencies</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">[]; </span><span style="color:#6A737D;">// 依赖数组，存储依赖模块的路径</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">mapping</span><span style="color:#D73A49;">?:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Record</span><span style="color:#24292E;">&lt;</span><span style="color:#005CC5;">string</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">&gt;; </span><span style="color:#6A737D;">// 依赖的相对路径和绝对路径的映射关系</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ul><li><strong><code>id</code></strong>：提供一个模块的唯一标识符。在大多数情况下，可以使用模块的文件路径作为其ID。</li><li><strong><code>filePath</code></strong>：存储模块文件的路径。这对于模块解析和后续的打包过程非常关键。</li><li><strong><code>content</code></strong>：包含模块的原始文本内容。这对于后续的代码转换和打包过程是必需的。</li><li><strong><code>dependencies</code></strong>：一个字符串数组，包含该模块依赖的其他模块的路径。这对于构建依赖图和管理模块间的关系至关重要。</li><li><strong><code>mapping</code></strong>：map 对象，保存依赖的相对路径和绝对路径的映射关系。</li></ul><p>设计好模块对象类型后，我们接着就是提取文件的信息，生成一个个模块类型实例子。</p><p>从上方定义的字段来看，我们过程会使用到<code>读取文件</code>、<code>路径计算</code>、<code>ast 依赖提取</code>。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createModule</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">filePath</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Module</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fileExtension</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">extname</span><span style="color:#E1E4E8;">(filePath);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> content </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dependencies</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">[] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mapping</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Record</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (fileExtension </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;.js&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    content </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(filePath, </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ast</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> parser.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(content, {</span></span>
<span class="line"><span style="color:#E1E4E8;">      sourceType: </span><span style="color:#9ECBFF;">&quot;module&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">transformFromAstSync</span><span style="color:#E1E4E8;">(ast, content, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        presets: [</span><span style="color:#9ECBFF;">&quot;@babel/preset-env&quot;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">      }) </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    content </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> code </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> content;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">traverse</span><span style="color:#E1E4E8;">(ast, {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ImportDeclaration</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">node</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        dependencies.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(node.source.value);</span></span>
<span class="line"><span style="color:#E1E4E8;">      },</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">CallExpression</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">node</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">          node.callee.type </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Identifier&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#E1E4E8;">          node.callee.name </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;require&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ) {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (BabelType.</span><span style="color:#B392F0;">isStringLiteral</span><span style="color:#E1E4E8;">(node.arguments[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">])) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            dependencies.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(node.arguments[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">].value);</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      },</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    dependencies.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">dependency</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">absoluteDependencyPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(filePath, </span><span style="color:#9ECBFF;">&quot;..&quot;</span><span style="color:#E1E4E8;">, dependency);</span></span>
<span class="line"><span style="color:#E1E4E8;">      mapping[dependency] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> absoluteDependencyPath;</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (fileExtension </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;.json&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 直接读取JSON文件并转换为JavaScript对象</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">jsonContent</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(filePath, </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    content </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`module.exports = ${</span><span style="color:#E1E4E8;">jsonContent</span><span style="color:#9ECBFF;">}`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    id: path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(filePath),</span></span>
<span class="line"><span style="color:#E1E4E8;">    filePath,</span></span>
<span class="line"><span style="color:#E1E4E8;">    content,</span></span>
<span class="line"><span style="color:#E1E4E8;">    dependencies,</span></span>
<span class="line"><span style="color:#E1E4E8;">    mapping,</span></span>
<span class="line"><span style="color:#E1E4E8;">  };</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createModule</span><span style="color:#24292E;">(</span><span style="color:#E36209;">filePath</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Module</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fileExtension</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">extname</span><span style="color:#24292E;">(filePath);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> content </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dependencies</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">[] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mapping</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Record</span><span style="color:#24292E;">&lt;</span><span style="color:#005CC5;">string</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (fileExtension </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;.js&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    content </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(filePath, </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ast</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> parser.</span><span style="color:#6F42C1;">parse</span><span style="color:#24292E;">(content, {</span></span>
<span class="line"><span style="color:#24292E;">      sourceType: </span><span style="color:#032F62;">&quot;module&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">transformFromAstSync</span><span style="color:#24292E;">(ast, content, {</span></span>
<span class="line"><span style="color:#24292E;">        presets: [</span><span style="color:#032F62;">&quot;@babel/preset-env&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">      }) </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    content </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> code </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> content;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">traverse</span><span style="color:#24292E;">(ast, {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ImportDeclaration</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">node</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">        dependencies.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(node.source.value);</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">CallExpression</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">node</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">          node.callee.type </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Identifier&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span></span>
<span class="line"><span style="color:#24292E;">          node.callee.name </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;require&quot;</span></span>
<span class="line"><span style="color:#24292E;">        ) {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (BabelType.</span><span style="color:#6F42C1;">isStringLiteral</span><span style="color:#24292E;">(node.arguments[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">])) {</span></span>
<span class="line"><span style="color:#24292E;">            dependencies.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(node.arguments[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">].value);</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    dependencies.</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">((</span><span style="color:#E36209;">dependency</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">absoluteDependencyPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(filePath, </span><span style="color:#032F62;">&quot;..&quot;</span><span style="color:#24292E;">, dependency);</span></span>
<span class="line"><span style="color:#24292E;">      mapping[dependency] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> absoluteDependencyPath;</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (fileExtension </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;.json&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 直接读取JSON文件并转换为JavaScript对象</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">jsonContent</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(filePath, </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    content </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`module.exports = ${</span><span style="color:#24292E;">jsonContent</span><span style="color:#032F62;">}`</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    id: path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(filePath),</span></span>
<span class="line"><span style="color:#24292E;">    filePath,</span></span>
<span class="line"><span style="color:#24292E;">    content,</span></span>
<span class="line"><span style="color:#24292E;">    dependencies,</span></span>
<span class="line"><span style="color:#24292E;">    mapping,</span></span>
<span class="line"><span style="color:#24292E;">  };</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>我们尝试解析一个文件。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;hello, world&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;hello, world&#39;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">&#39;</span></span></code></pre></div><p>输入的结果如下：能看到在下方，我们已经进行了文件内容的提取。</p><p><img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/1bfe1f66105a409d9c1c61715815e3f4%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="image.png"></p><p>上方，我们已经实现了<code>模块解析</code>中<code>文件读取</code>，<code>模块类型处理</code>，<code>依赖检测</code>的三个功能。</p><p>接着，我们来实现依赖图构建。</p><h3 id="依赖图构建" tabindex="-1">依赖图构建 <a class="header-anchor" href="#依赖图构建" aria-label="Permalink to &quot;依赖图构建&quot;">​</a></h3><p>依赖图构建是模块打包器的关键环节，主要用图的数据结构管理和优化模块间的依赖关系。</p><ul><li><code>依赖关系</code>：依赖图为应用的模块结构提供了一个清晰的视图，展示了不同模块之间的依赖关系。</li><li><code>优化操作</code>：通过分析依赖图，打包器可以确定哪些模块是必需的，哪些不是，从而仅包含必要的模块，减少最终包的大小。</li><li><code>依赖错误/冲突</code>：在构建依赖图时，可以检测到版本冲突或不兼容的依赖，从而提前处理这些问题。依赖图帮助识别循环依赖问题，这是一种常见的错误情况。</li></ul><p><img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/6fdf9c06660844e987dabb7dafbcb411%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="image.png"></p><p>从上图来看，依赖图的构建，本质上从<code>入口文件</code>开始，去对文件进行递归遍历，生成每个文件的模块信息，并且关联起来。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 创建依赖关系图。</span></span>
<span class="line"><span style="color:#6A737D;"> * 此函数根据入口文件路径构建项目的依赖关系图。它递归地遍历每个模块的依赖项，</span></span>
<span class="line"><span style="color:#6A737D;"> * 并将它们添加到依赖关系图中，这个图是一个映射，键为模块ID，值为模块对象。</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> </span><span style="color:#B392F0;">{string}</span><span style="color:#6A737D;"> </span><span style="color:#E1E4E8;">entry</span><span style="color:#6A737D;"> - 入口文件的路径。</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@returns</span><span style="color:#6A737D;"> </span><span style="color:#B392F0;">{DependencyGraph}</span><span style="color:#6A737D;"> - 表示依赖关系的图，这是一个映射，其中键是模块ID，值是模块对象。</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createDependencyGraph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">entry</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DependencyGraph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> { </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 入口文件模块</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">entryModule</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createModule</span><span style="color:#E1E4E8;">(entry);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 构建依赖图</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graph</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DependencyGraph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Map</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Module</span><span style="color:#E1E4E8;">&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">explore</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">module</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Module</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 有过了，就不再处理了。</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (graph.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 没有的话，则加入依赖图中</span></span>
<span class="line"><span style="color:#E1E4E8;">    graph.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 遍历模块的其他依赖</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.dependencies.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">dependencyPath</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">absoluteDependencyPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.filePath,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;..&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        dependencyPath</span></span>
<span class="line"><span style="color:#E1E4E8;">      );</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dependencyModule</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createModule</span><span style="color:#E1E4E8;">(absoluteDependencyPath);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">explore</span><span style="color:#E1E4E8;">(dependencyModule);</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">explore</span><span style="color:#E1E4E8;">(entryModule);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> graph;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 创建依赖关系图。</span></span>
<span class="line"><span style="color:#6A737D;"> * 此函数根据入口文件路径构建项目的依赖关系图。它递归地遍历每个模块的依赖项，</span></span>
<span class="line"><span style="color:#6A737D;"> * 并将它们添加到依赖关系图中，这个图是一个映射，键为模块ID，值为模块对象。</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#6F42C1;">{string}</span><span style="color:#6A737D;"> </span><span style="color:#24292E;">entry</span><span style="color:#6A737D;"> - 入口文件的路径。</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@returns</span><span style="color:#6A737D;"> </span><span style="color:#6F42C1;">{DependencyGraph}</span><span style="color:#6A737D;"> - 表示依赖关系的图，这是一个映射，其中键是模块ID，值是模块对象。</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createDependencyGraph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">entry</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DependencyGraph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> { </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 入口文件模块</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">entryModule</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createModule</span><span style="color:#24292E;">(entry);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 构建依赖图</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graph</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DependencyGraph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Map</span><span style="color:#24292E;">&lt;</span><span style="color:#005CC5;">string</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">Module</span><span style="color:#24292E;">&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">explore</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">module</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Module</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 有过了，就不再处理了。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (graph.</span><span style="color:#6F42C1;">has</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 没有的话，则加入依赖图中</span></span>
<span class="line"><span style="color:#24292E;">    graph.</span><span style="color:#6F42C1;">set</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">module</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 遍历模块的其他依赖</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">module</span><span style="color:#24292E;">.dependencies.</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">((</span><span style="color:#E36209;">dependencyPath</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">absoluteDependencyPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">module</span><span style="color:#24292E;">.filePath,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;..&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        dependencyPath</span></span>
<span class="line"><span style="color:#24292E;">      );</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dependencyModule</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createModule</span><span style="color:#24292E;">(absoluteDependencyPath);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">explore</span><span style="color:#24292E;">(dependencyModule);</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">explore</span><span style="color:#24292E;">(entryModule);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> graph;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><h3 id="代码转换" tabindex="-1">代码转换 <a class="header-anchor" href="#代码转换" aria-label="Permalink to &quot;代码转换&quot;">​</a></h3><p>上方已经将依赖图进行了构建，最后，我们只要将依赖图转换为可执行代码，理论上我们最小的 bundler 就可以完成了。</p><p>但这里有几个问题</p><ol><li><strong><code>依赖映射模块关系</code></strong>：模块中的依赖如何找到自己的模块信息，需要有一个映射关系。</li><li><strong><code>浏览器代码无法执行模块化语法</code></strong>：即使我们在构建 <code>module</code> 的时候，会将语法进行兼容，但也还是会有 <code>require</code>，<code>export</code> 在浏览器无法运行问题。</li></ol><p>关于这两个问题，都有解法。即生成模块信息以及自定义模块化导入，导出语法。</p><ol><li><strong><code>依赖映射模块关系</code></strong>：可以通过依赖的相对路径和绝对路径来处理。</li></ol><ul><li>我们有依赖图，且依赖图是根据<code>绝对路径</code>为键，模块信息为值。</li><li>模块项都有自己依赖的<code>相对路径</code>和<code>绝对路径</code>的映射关系。</li><li>我们可以自定义 <code>require</code>。</li></ul><p>所以，我们可以自定义 <code>require</code>，<code>module</code>, <code>module.exports</code>, 将 <code>require(相对路径)</code> --&gt; 找到模块中绝对路径的模块信息</p><p>核心代码</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">`</span></span>
<span class="line"><span style="color:#9ECBFF;">  (function(modules) {</span></span>
<span class="line"><span style="color:#9ECBFF;">    function require(id) {</span></span>
<span class="line"><span style="color:#9ECBFF;">      const [fn, dependencies] = modules[id];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">      function localRequire(relativePath) {</span></span>
<span class="line"><span style="color:#9ECBFF;">        return require(dependencies[relativePath]);</span></span>
<span class="line"><span style="color:#9ECBFF;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">      const module = { exports: {} };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">      fn(localRequire, module, module.exports);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">      return module.exports;</span></span>
<span class="line"><span style="color:#9ECBFF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">    require(&quot;${</span><span style="color:#E1E4E8;">graph</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">keys</span><span style="color:#9ECBFF;">().</span><span style="color:#B392F0;">next</span><span style="color:#9ECBFF;">().</span><span style="color:#E1E4E8;">value</span><span style="color:#9ECBFF;">}&quot;);</span></span>
<span class="line"><span style="color:#9ECBFF;">  })({${</span><span style="color:#E1E4E8;">modules</span><span style="color:#9ECBFF;">}})</span></span>
<span class="line"><span style="color:#9ECBFF;">`</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">`</span></span>
<span class="line"><span style="color:#032F62;">  (function(modules) {</span></span>
<span class="line"><span style="color:#032F62;">    function require(id) {</span></span>
<span class="line"><span style="color:#032F62;">      const [fn, dependencies] = modules[id];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">      function localRequire(relativePath) {</span></span>
<span class="line"><span style="color:#032F62;">        return require(dependencies[relativePath]);</span></span>
<span class="line"><span style="color:#032F62;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">      const module = { exports: {} };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">      fn(localRequire, module, module.exports);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">      return module.exports;</span></span>
<span class="line"><span style="color:#032F62;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">    require(&quot;${</span><span style="color:#24292E;">graph</span><span style="color:#032F62;">.</span><span style="color:#6F42C1;">keys</span><span style="color:#032F62;">().</span><span style="color:#6F42C1;">next</span><span style="color:#032F62;">().</span><span style="color:#24292E;">value</span><span style="color:#032F62;">}&quot;);</span></span>
<span class="line"><span style="color:#032F62;">  })({${</span><span style="color:#24292E;">modules</span><span style="color:#032F62;">}})</span></span>
<span class="line"><span style="color:#032F62;">`</span><span style="color:#24292E;">;</span></span></code></pre></div><p>于是，整体代码为</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 打包依赖关系图为单一字符串。</span></span>
<span class="line"><span style="color:#6A737D;"> * 此函数接收一个依赖关系图，将其转换为一个包含所有模块和它们依赖的单一字符串。</span></span>
<span class="line"><span style="color:#6A737D;"> * 字符串的格式允许它被执行并作为模块系统使用，其中每个模块都被封装在一个函数中，</span></span>
<span class="line"><span style="color:#6A737D;"> * 并且有一个映射来表示其依赖关系。</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> </span><span style="color:#B392F0;">{DependencyGraph}</span><span style="color:#6A737D;"> </span><span style="color:#E1E4E8;">graph</span><span style="color:#6A737D;"> - 依赖关系图，包含项目中所有模块的信息。</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@returns</span><span style="color:#6A737D;"> </span><span style="color:#B392F0;">{string}</span><span style="color:#6A737D;"> - 一个字符串，包含所有模块及其依赖，可以被执行以模拟模块系统。</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">bundle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">graph</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DependencyGraph</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> modules </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  graph.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">mod</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    modules </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`</span></span>
<span class="line"><span style="color:#9ECBFF;">      &quot;${</span><span style="color:#E1E4E8;">mod</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">id</span><span style="color:#9ECBFF;">}&quot;: [</span></span>
<span class="line"><span style="color:#9ECBFF;">        function (require, module, exports) {</span></span>
<span class="line"><span style="color:#9ECBFF;">          ${</span><span style="color:#E1E4E8;">mod</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">content</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#9ECBFF;">        },</span></span>
<span class="line"><span style="color:#9ECBFF;">        ${</span><span style="color:#79B8FF;">JSON</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#9ECBFF;">(</span><span style="color:#E1E4E8;">mod</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">mapping</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">},</span></span>
<span class="line"><span style="color:#9ECBFF;">      ],</span></span>
<span class="line"><span style="color:#9ECBFF;">    `</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`</span></span>
<span class="line"><span style="color:#9ECBFF;">    (function(modules) {</span></span>
<span class="line"><span style="color:#9ECBFF;">      function require(id) {</span></span>
<span class="line"><span style="color:#9ECBFF;">        const [fn, dependencies] = modules[id];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">        function localRequire(relativePath) {</span></span>
<span class="line"><span style="color:#9ECBFF;">          return require(dependencies[relativePath]);</span></span>
<span class="line"><span style="color:#9ECBFF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">        const module = { exports: {} };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">        fn(localRequire, module, module.exports);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">        return module.exports;</span></span>
<span class="line"><span style="color:#9ECBFF;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">      require(&quot;${</span><span style="color:#E1E4E8;">graph</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">keys</span><span style="color:#9ECBFF;">().</span><span style="color:#B392F0;">next</span><span style="color:#9ECBFF;">().</span><span style="color:#E1E4E8;">value</span><span style="color:#9ECBFF;">}&quot;);</span></span>
<span class="line"><span style="color:#9ECBFF;">    })({${</span><span style="color:#E1E4E8;">modules</span><span style="color:#9ECBFF;">}})</span></span>
<span class="line"><span style="color:#9ECBFF;">  `</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 打包依赖关系图为单一字符串。</span></span>
<span class="line"><span style="color:#6A737D;"> * 此函数接收一个依赖关系图，将其转换为一个包含所有模块和它们依赖的单一字符串。</span></span>
<span class="line"><span style="color:#6A737D;"> * 字符串的格式允许它被执行并作为模块系统使用，其中每个模块都被封装在一个函数中，</span></span>
<span class="line"><span style="color:#6A737D;"> * 并且有一个映射来表示其依赖关系。</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#6F42C1;">{DependencyGraph}</span><span style="color:#6A737D;"> </span><span style="color:#24292E;">graph</span><span style="color:#6A737D;"> - 依赖关系图，包含项目中所有模块的信息。</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@returns</span><span style="color:#6A737D;"> </span><span style="color:#6F42C1;">{string}</span><span style="color:#6A737D;"> - 一个字符串，包含所有模块及其依赖，可以被执行以模拟模块系统。</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">bundle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">graph</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DependencyGraph</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> modules </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  graph.</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">((</span><span style="color:#E36209;">mod</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    modules </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`</span></span>
<span class="line"><span style="color:#032F62;">      &quot;${</span><span style="color:#24292E;">mod</span><span style="color:#032F62;">.</span><span style="color:#24292E;">id</span><span style="color:#032F62;">}&quot;: [</span></span>
<span class="line"><span style="color:#032F62;">        function (require, module, exports) {</span></span>
<span class="line"><span style="color:#032F62;">          ${</span><span style="color:#24292E;">mod</span><span style="color:#032F62;">.</span><span style="color:#24292E;">content</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#032F62;">        },</span></span>
<span class="line"><span style="color:#032F62;">        ${</span><span style="color:#005CC5;">JSON</span><span style="color:#032F62;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#032F62;">(</span><span style="color:#24292E;">mod</span><span style="color:#032F62;">.</span><span style="color:#24292E;">mapping</span><span style="color:#032F62;">)</span><span style="color:#032F62;">},</span></span>
<span class="line"><span style="color:#032F62;">      ],</span></span>
<span class="line"><span style="color:#032F62;">    `</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`</span></span>
<span class="line"><span style="color:#032F62;">    (function(modules) {</span></span>
<span class="line"><span style="color:#032F62;">      function require(id) {</span></span>
<span class="line"><span style="color:#032F62;">        const [fn, dependencies] = modules[id];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">        function localRequire(relativePath) {</span></span>
<span class="line"><span style="color:#032F62;">          return require(dependencies[relativePath]);</span></span>
<span class="line"><span style="color:#032F62;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">        const module = { exports: {} };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">        fn(localRequire, module, module.exports);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">        return module.exports;</span></span>
<span class="line"><span style="color:#032F62;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">      require(&quot;${</span><span style="color:#24292E;">graph</span><span style="color:#032F62;">.</span><span style="color:#6F42C1;">keys</span><span style="color:#032F62;">().</span><span style="color:#6F42C1;">next</span><span style="color:#032F62;">().</span><span style="color:#24292E;">value</span><span style="color:#032F62;">}&quot;);</span></span>
<span class="line"><span style="color:#032F62;">    })({${</span><span style="color:#24292E;">modules</span><span style="color:#032F62;">}})</span></span>
<span class="line"><span style="color:#032F62;">  `</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>代码写完，我们来做一个测试。</p><p><code>index.js</code> 文件： 入口文件，引入 <code>add.js</code><img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/7af896e4dd0d480a883652cbdc6bd3f5%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="image.png"></p><p><code>add.js</code> 文件: 引入 sub 函数，并提供 add，sub 函数。</p><p><img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/4d375fb5048341e89c3644b3544ee0c8%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="image.png"></p><p><code>sub.js</code> 文件: 提供 sub 函数。 <img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/124158410c3d4a4c9924baf89644b391%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="image.png"> 最终运行，得到下方的代码</p><p>我们将 <code>index.js</code> 作为入口文件</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">filePath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;./index.js&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createDependencyGraph</span><span style="color:#E1E4E8;">(filePath);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">result</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">bundle</span><span style="color:#E1E4E8;">(graph);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">outputPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;./output/bundle.js&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">writeFileSync</span><span style="color:#E1E4E8;">(outputPath, result);</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">filePath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;./index.js&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createDependencyGraph</span><span style="color:#24292E;">(filePath);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">result</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">bundle</span><span style="color:#24292E;">(graph);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">outputPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;./output/bundle.js&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">writeFileSync</span><span style="color:#24292E;">(outputPath, result);</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">modules</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">id</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">fn</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">dependencies</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> modules[id];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">localRequire</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">relativePath</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(dependencies[relativePath]);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { exports: {} };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">fn</span><span style="color:#E1E4E8;">(localRequire, </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/index.js&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">})({</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/index.js&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">require</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">module</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">exports</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;use strict&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _add </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;./add.js&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, _add.add)(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, _add.sub)(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(a, b);</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;./add.js&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/add.js&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/add.js&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">require</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">module</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">exports</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;use strict&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      Object.</span><span style="color:#B392F0;">defineProperty</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;__esModule&quot;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        value: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.add </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      Object.</span><span style="color:#B392F0;">defineProperty</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;sub&quot;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        enumerable: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> _sub.sub;</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _sub </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;./sub.js&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> add </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">a</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">b</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> b;</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _default </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> add);</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;./sub.js&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/sub.js&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/sub.js&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">require</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">module</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">exports</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;use strict&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      Object.</span><span style="color:#B392F0;">defineProperty</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;__esModule&quot;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        value: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.sub </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> sub;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sub</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">a</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">b</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> b;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    {},</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">(</span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">modules</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#E36209;">id</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">fn</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">dependencies</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> modules[id];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">localRequire</span><span style="color:#24292E;">(</span><span style="color:#E36209;">relativePath</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(dependencies[relativePath]);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">module</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { exports: {} };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">fn</span><span style="color:#24292E;">(localRequire, </span><span style="color:#005CC5;">module</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/index.js&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">})({</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/index.js&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">require</span><span style="color:#24292E;">, </span><span style="color:#E36209;">module</span><span style="color:#24292E;">, </span><span style="color:#E36209;">exports</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;use strict&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _add </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;./add.js&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> a </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, _add.add)(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, _add.sub)(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(a, b);</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;./add.js&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/add.js&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/add.js&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">require</span><span style="color:#24292E;">, </span><span style="color:#E36209;">module</span><span style="color:#24292E;">, </span><span style="color:#E36209;">exports</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;use strict&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      Object.</span><span style="color:#6F42C1;">defineProperty</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;__esModule&quot;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">        value: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.add </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      Object.</span><span style="color:#6F42C1;">defineProperty</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;sub&quot;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">        enumerable: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> _sub.sub;</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _sub </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;./sub.js&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> add </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span><span style="color:#E36209;">a</span><span style="color:#24292E;">, </span><span style="color:#E36209;">b</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> a </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> b;</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _default </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> add);</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;./sub.js&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/sub.js&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;/xxxxx/xxxxx//wheel-awesome/mini-bundler/src/sub.js&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">require</span><span style="color:#24292E;">, </span><span style="color:#E36209;">module</span><span style="color:#24292E;">, </span><span style="color:#E36209;">exports</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;use strict&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      Object.</span><span style="color:#6F42C1;">defineProperty</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;__esModule&quot;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">        value: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.sub </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> sub;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sub</span><span style="color:#24292E;">(</span><span style="color:#E36209;">a</span><span style="color:#24292E;">, </span><span style="color:#E36209;">b</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> a </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> b;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {},</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>运行代码，也得到了正确的输出。</p><p><img src="https://raw.githubusercontent.com/hua-bang/assert-store/master/7099a114958642a191a0f35806fe423c%7Etplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image" alt="image.png"></p><p>一个简单的 bundler 就实现了。当然，目前还有很多细节，如<code>循环依赖</code>，<code>文件扩展</code>，<code>插件系统</code>等东西都还没有实现，但理论上也是个 mvp 的版本。<strong>主要是为了了解一个 bundler 是如何运作的</strong>。</p><p>由于篇幅关系，所以<code>插件系统</code>会专门在开一篇文章讲解。</p><h2 id="_4-总结" tabindex="-1">4. 总结 <a class="header-anchor" href="#_4-总结" aria-label="Permalink to &quot;4. 总结&quot;">​</a></h2><p>本文简单的简单介绍了 <code>bundler 的主要能力</code>，设计一个简单的 <code>mini bundler</code>, <code>bundler</code>技术细节点（<code>模块解析</code>，<code>依赖图构建</code>，<code>代码转换</code>）的实现。</p><p>这也仅仅是一个简易的 <code>bundler</code> 的开始，下一章会继续设计其插件系统。</p><h2 id="资料" tabindex="-1">资料 <a class="header-anchor" href="#资料" aria-label="Permalink to &quot;资料&quot;">​</a></h2><ul><li><a href="https://github.com/hua-bang/wheel-awesome/tree/master/mini-bundler/src" target="_blank" rel="noreferrer">代码实现</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><!----><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7de715c0>Updated at: <time datetime="2024-04-17T00:52:40.000Z" data-v-7de715c0></time></p></div></div><nav class="prev-next" data-v-ef5dee53><div class="pager" data-v-ef5dee53><a class="pager-link prev" href="/blog/tech/bundler.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Previous page</span><span class="title" data-v-ef5dee53>初识前端 bundler</span></a></div><div class="pager" data-v-ef5dee53><a class="pager-link next" href="/blog/tech/mini-bundler-plugin.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Next page</span><span class="title" data-v-ef5dee53>mini bundler 插件系统</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-1919c326 data-v-e03eb2e1><div class="container" data-v-e03eb2e1><p class="message" data-v-e03eb2e1>Released under the MIT License.</p><p class="copyright" data-v-e03eb2e1>Copyright © 2023-present 华铧.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"react_react-source-code_index.md\":\"728f034f\",\"react_react-source-code_render.md\":\"2ddfffcf\",\"read_index.md\":\"3f399dab\",\"algorithms_algorithms_search_hash_search.md\":\"756918a3\",\"tech_typescript-skill.md\":\"7da11429\",\"blog_dify.md\":\"2508ddbd\",\"blog_content-search.md\":\"1ea89fbf\",\"blog_in-clusion.md\":\"150b96ca\",\"algorithms_index.md\":\"a527c268\",\"blog_information-overload.md\":\"cd8c5e30\",\"blog_openai-dev-day.md\":\"2c3bbb36\",\"blog_arc-max.md\":\"7245302d\",\"tech_chat-bot.md\":\"cf675918\",\"read_the-almanack-of-naval-ravikant.md\":\"020a5d47\",\"algorithms_algorithms_concept.md\":\"2931ba3e\",\"blog_google-developer-groups.md\":\"040c7474\",\"blog_aws-aigc.md\":\"d70ffc3f\",\"blog_subscribe-or-recommend.md\":\"6689a0d7\",\"life_index.md\":\"ce3df6cb\",\"tech_babel-javascript-compiler.md\":\"0346fbe0\",\"read_a-philosophy-of-software-design.md\":\"fc47953c\",\"tech_index.md\":\"a552f610\",\"read_amusing-yourself-to-death.md\":\"73ad64f8\",\"tech_gpt-agent.md\":\"86d8dfa2\",\"algorithms_data-structure_hash-table.md\":\"b5411fc1\",\"tech_webpack-hmr.md\":\"82e14abf\",\"read_take-notes.md\":\"066b7b49\",\"tech_introduction-front-end-compilation.md\":\"edf911d5\",\"tech_mini-bundler-plugin.md\":\"05022e87\",\"blog_coze.md\":\"788a34ac\",\"read_when-i-say-no_i-feel-guilty.md\":\"2246de26\",\"blog_fe-day.md\":\"d4eca224\",\"me_index.md\":\"0d3afadc\",\"tech_gpt-review.md\":\"b61a314f\",\"blog_summary-2023.md\":\"4ceef465\",\"index.md\":\"67bda478\",\"react_index.md\":\"bbcfe897\",\"algorithms_data-structure_stack.md\":\"0b3f9891\",\"tech_mini-bundler-loader.md\":\"3d274ae2\",\"tech_super-tiny-compiler.md\":\"9aa1cb56\",\"react_react-source-code_scheduler.md\":\"440d5b69\",\"algorithms_data-structure_tree_avl-tree.md\":\"c62b331a\",\"algorithms_data-structure_linked-list.md\":\"82baf3a2\",\"algorithms_data-structure_graph_index.md\":\"6211b3ad\",\"react_react-source-code_base-data-structure.md\":\"752ae205\",\"blog_index.md\":\"cabb3f54\",\"tech_bundler.md\":\"2cea58fe\",\"read_that-will-never-work.md\":\"c4e5defc\",\"blog_aigc-think.md\":\"a1420a1b\",\"algorithms_data-structure_queue.md\":\"a25786c5\",\"algorithms_algorithms_search_binary_search.md\":\"fdb7d213\",\"blog_mwc-23.md\":\"8913da92\",\"algorithms_data-structure_tree_binary-search-tree.md\":\"d682ef52\",\"tech_mini-bundler.md\":\"4fdbfea2\",\"algorithms_algorithms_search_over-view.md\":\"0632904a\",\"read_principles.md\":\"2464e048\",\"tech_auto-tracker.md\":\"d2f1d639\",\"algorithms_data-structure_tree_binary-tree.md\":\"343c76ee\",\"algorithms_data-structure_heap.md\":\"f402e873\",\"algorithms_data-structure_tree_index.md\":\"62eada75\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"华铧's Blog\",\"description\":\"Inspire Creativity, Enrich Life.\",\"base\":\"/blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":{\"src\":\"https://avatars.githubusercontent.com/u/47221942?v=4\",\"style\":{\"borderRadius\":\"50%\"}},\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"🧑🏻‍💻 Tech\",\"link\":\"/tech/\"},{\"text\":\"✍🏼 Blog\",\"link\":\"/blog/\"},{\"text\":\"📖 Read\",\"link\":\"/read/\"},{\"text\":\"📚 Algorithms\",\"link\":\"/algorithms/\"},{\"text\":\"👋🏻 Life\",\"link\":\"/life/\"},{\"text\":\"⭐️ Me\",\"link\":\"/me/\"}],\"sidebar\":{\"/blog/\":[{\"text\":\"线下活动\",\"items\":[{\"text\":\"in.clusion\",\"link\":\"/blog/in-clusion\"},{\"text\":\"亚马逊云科技社区嘉年华\",\"link\":\"/blog/aws-aigc\"},{\"text\":\"# MWC 2023\",\"link\":\"/blog/mwc-23\"},{\"text\":\"FeDay\",\"link\":\"/blog/fe-day\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/blog/google-developer-groups.md\",\"text\":\"Google Developer groups\",\"link\":\"/blog/google-developer-groups.md\"}]},{\"text\":\"互联网\",\"items\":[{\"text\":\"AIGC 思考\",\"link\":\"/blog/aigc-think\"},{\"text\":\"信息过载\",\"link\":\"/blog/information-overload\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/blog/subscribe-or-recommend.md\",\"text\":\"有多久没看公众号了。\",\"link\":\"/blog/subscribe-or-recommend.md\"}]},{\"text\":\"产品思考\",\"items\":[{\"text\":\"小红书-内容搜索\",\"link\":\"/blog/content-search\"}]},{\"text\":\"AIGC\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/blog/arc-max.md\",\"text\":\"👋 Arc 公司全新 AI 功能来啦！🎉\",\"link\":\"/blog/arc-max.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/blog/openai-dev-day.md\",\"text\":\"OpenAI 开发者大会\",\"link\":\"/blog/openai-dev-day.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/blog/coze.md\",\"text\":\"Coze 机器人构建平台\",\"link\":\"/blog/coze.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/blog/dify.md\",\"text\":\"🚀 探索 Dify：开源LLM应用开发的未来 🚀\",\"link\":\"/blog/dify.md\"}]},{\"text\":\"AnnualSummary\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/blog/summary-2023.md\",\"text\":\"2023 🥳 允许一切发生\",\"link\":\"/blog/summary-2023.md\"}]}],\"/tech/\":[{\"text\":\"AIGC\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/gpt-agent.md\",\"text\":\"基于 GPT 实现 Agent  🤖️\",\"link\":\"/tech/gpt-agent.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/chat-bot.md\",\"text\":\"基于 OpenAI 的 API 快速搭建 ChaBot 🤖️\",\"link\":\"/tech/chat-bot.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/gpt-review.md\",\"text\":\"GPT + GitHub 实现自动 Code Review\",\"link\":\"/tech/gpt-review.md\"}]},{\"text\":\"编译\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/babel-javaScript-compiler.md\",\"text\":\"Babel: A JavaScript Compiler\",\"link\":\"/tech/babel-javaScript-compiler.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/super-tiny-compiler.md\",\"text\":\"通过 the-super-tiny-compiler 初识编译\",\"link\":\"/tech/super-tiny-compiler.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/auto-tracker.md\",\"text\":\"通过 Babel 编译实现自动点击埋点\",\"link\":\"/tech/auto-tracker.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/introduction-front-end-compilation.md\",\"text\":\"初识前端编译及 Babel\",\"link\":\"/tech/introduction-front-end-compilation.md\"}]},{\"text\":\"Frontend Engineer\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/bundler.md\",\"text\":\"初识前端 bundler\",\"link\":\"/tech/bundler.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/mini-bundler.md\",\"text\":\"mini bundler 的实现\",\"link\":\"/tech/mini-bundler.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/mini-bundler-plugin.md\",\"text\":\"mini bundler 插件系统\",\"link\":\"/tech/mini-bundler-plugin.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/mini-bundler-loader.md\",\"text\":\"mini-bundler 实现：loader\",\"link\":\"/tech/mini-bundler-loader.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/webpack-hmr.md\",\"text\":\"webpack 中的 HMR\",\"link\":\"/tech/webpack-hmr.md\"}]},{\"text\":\"TypeScript\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/tech/typescript-skill.md\",\"text\":\"TypeScript的类型编程小技巧\",\"link\":\"/tech/typescript-skill.md\"}]}],\"/read/\":[{\"text\":\"个人成长\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/read/take-notes.md\",\"text\":\"笔记的方法\",\"link\":\"/read/take-notes.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/read/amusing-yourself-to-death.md\",\"text\":\"娱乐至死\",\"link\":\"/read/amusing-yourself-to-death.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/read/the-almanack-of-Naval-Ravikant.md\",\"text\":\"纳瓦尔宝典\",\"link\":\"/read/the-almanack-of-Naval-Ravikant.md\"}]},{\"text\":\"创业\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/read/that-will-never-work.md\",\"text\":\"复盘网飞\",\"link\":\"/read/that-will-never-work.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/read/principles.md\",\"text\":\"原则\",\"link\":\"/read/principles.md\"}]},{\"text\":\"心理学\",\"items\":[{\"id\":\"/workspaces/blog/docs/read/When-I-say-no_I-feel-guilty.md\",\"text\":\"强势\",\"link\":\"/read/When-I-say-no_I-feel-guilty.md\"}]},{\"text\":\"计算机\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/read/a-philosophy-of-software-design.md\",\"text\":\"A Philosophy of Software Design\",\"link\":\"/read/a-philosophy-of-software-design.md\"}]}],\"/algorithms/\":[{\"text\":\"数据结构\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/data-structure/linked-list.md\",\"text\":\"链表\",\"link\":\"/algorithms/data-structure/linked-list.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/data-structure/queue.md\",\"text\":\"队列\",\"link\":\"/algorithms/data-structure/queue.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/data-structure/stack.md\",\"text\":\"栈\",\"link\":\"/algorithms/data-structure/stack.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/data-structure/hash-table.md\",\"text\":\"哈希表\",\"link\":\"/algorithms/data-structure/hash-table.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/data-structure/heap.md\",\"text\":\"堆\",\"link\":\"/algorithms/data-structure/heap.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/data-structure/tree/index.md\",\"text\":\"树\",\"items\":[{\"text\":\"概览\",\"link\":\"/algorithms/data-structure/tree/index.md\"},{\"text\":\"二叉树\",\"link\":\"/algorithms/data-structure/tree/binary-tree.md\"},{\"text\":\"二叉搜索树\",\"link\":\"/algorithms/data-structure/tree/binary-search-tree.md\"},{\"text\":\"AVL 树\",\"link\":\"/algorithms/data-structure/tree/avl-tree.md\"}]},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/data-structure/graph/index.md\",\"text\":\"图\",\"items\":[{\"text\":\"概览\",\"link\":\"/algorithms/data-structure/graph/index.md\"}]}]},{\"text\":\"算法\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/algorithms/concept.md\",\"text\":\"算法概念\",\"link\":\"/algorithms/algorithms/concept.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/algorithms/search/binary_search.md\",\"text\":\"搜索\",\"items\":[{\"text\":\"二分查找\",\"link\":\"/algorithms/algorithms/search/binary_search.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/algorithms/search/hash_search.md\",\"text\":\"哈希优化策略\",\"link\":\"/algorithms/algorithms/search/hash_search.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/algorithms/algorithms/search/over-view.md\",\"text\":\"搜索算法\",\"link\":\"/algorithms/algorithms/search/over-view.md\"}]}]}],\"/react/\":[{\"text\":\"React 源码解析\",\"items\":[{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/react/react-source-code/index.md\",\"text\":\"概述\",\"link\":\"/react/react-source-code/index.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/react/react-source-code/base-data-structure.md\",\"text\":\"React 基础数据类型\",\"link\":\"/react/react-source-code/base-data-structure.md\"},{\"id\":\"/Users/hujiahua/code/workBranch/blog/docs/react/react-source-code/scheduler.md\",\"text\":\"调度\",\"link\":\"/react/react-source-code/scheduler.md\"}]}]},\"lastUpdated\":{\"text\":\"Updated at\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/hua-bang\"}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2023-present 华铧.\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>